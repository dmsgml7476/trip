<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìŠ¤í† ë¦¬ í˜ì´ì§€</title>
  <style>
    .write-link {
      display: block;
      width: 66.66%;
      margin: 60px auto 20px auto;
      text-decoration: none;
    }

    #text-input {
      width: 100%;
      max-width: 1100px;
      box-sizing: border-box;
      text-align: center;
      font-size: 1.3em;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin: 40px auto 20px;
      display: block;
      cursor: pointer;
    }

    .main-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background-color: #f0f0f0;
  padding-bottom: 0;
  margin-bottom: 0;
}

    .story-header {
      font-size: 24px;
      font-weight: bold;
      color: #222;
      margin-bottom: 20px;
    }

  .story-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  margin-bottom: 50px; /* í‘¸í„°ì™€ ì¹´ë“œ ì‚¬ì´ ì ë‹¹í•œ ê°„ê²© */
  background-color: #f9f9f9; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
  padding: 15px; /* ì¹´ë“œì™€ ì»¨í…Œì´ë„ˆ ê°€ì¥ìë¦¬ ì‚¬ì´ ì—¬ë°± ì¶”ê°€ */
  border-radius: 8px; /* ì•½ê°„ ë‘¥ê·¼ ëª¨ì„œë¦¬ë„ ì¶”ê°€ ê°€ëŠ¥ */
}

.story-card {
  width: 40%;
  border: 1px solid #ccc;
  padding: 15px;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
  border-radius: 12px; /* í…Œë‘ë¦¬ ë‘¥ê¸€ê²Œ */
  background-color: white; /* ì¹´ë“œ ë°°ê²½ì€ í°ìƒ‰ìœ¼ë¡œ */
}


    .login-id {
      font-weight: bold;
      font-size: 14px;
      color: #444;
    }

    .story-title {
      font-size: 16px;
      font-weight: bold;
      margin: 8px 0;
    }

    .story-image {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin: 12px 0;
    }

    .story-content {
      font-size: 14px;
      color: #333;
      white-space: pre-line;
      margin-bottom: 10px;
    }

    .hashtags {
      color: #007acc;
      font-size: 13px;
      margin-bottom: 12px;
    }

    .actions {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 14px;
      margin-top: auto;
    }
    
    .actions span {
      cursor: pointer;
      color: #666;
    }

    .like-button,
    .comment-button {
      cursor: pointer;
      color: #666;
    }

    .comments {
      margin-top: 10px;
      display: none;
    }

    .comment {
      font-size: 13px;
      color: #444;
      margin-bottom: 4px;
    }

    .more-comments {
      font-size: 13px;
      color: #007acc;
      cursor: pointer;
      text-decoration: underline;
    }
    
     @media screen and (max-width: 768px) {
      .story-card {
        width: 100%;
      }
    }
    
       .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-overlay.visible {
      display: flex;
    }

    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .close-button {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 24px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
    }

    .close-button:hover {
      color: #777;
    }

    #comments-area .comment {
      margin-bottom: 10px;
    }

    #comment-input {
      width: 100%;
      padding: 8px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    #submit-comment {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #submit-comment:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
  <th:block th:replace="story/mainMenu :: mainMenu"></th:block>

  <a href="/weUpload" class="write-link">
    <input id="text-input" type="text" placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ğŸ‘‰" onclick="clearInPut(this)" readonly />
  </a>

  <div class="story-container" id="story-container">
    <div class="story-card" th:each="story, iterStat : ${cardList}"
         th:if="${iterStat.index} < 4"
         th:data-story-id="${story.storyId}"
         th:data-login-id="${story.loginId}"
        th:onclick="'window.location.href=\'/StoryDetail?id=' + ${story.storyId} + '\''" style="cursor: pointer;">
      <div class="login-id" th:text="'@' + ${story.loginId}">ì•„ì´ë””</div>
      <div class="story-title" th:text="${story.storyTitle}">ìŠ¤í† ë¦¬ ì œëª©</div>
      <img class="story-image"
           th:if="${story.storyImgUrl != null and !#strings.isEmpty(story.storyImgUrl)}"
           th:src="${story.storyImgUrl}" alt="story image" />
      <div class="story-content" th:text="${story.storyContent}">ë‚´ìš©</div>
      <div class="hashtags" th:if="${story.hashTags != null}">
        <span th:each="tag : ${story.hashTags}" th:text="'#' + ${tag} + ' '"></span>
      </div>
      <div class="actions">
        <span class="like-button" th:data-id="${story.storyId}" th:text="${story.isLike} ? 'ğŸ’— ê³µê°ì·¨ì†Œ' : 'ğŸ’— ê³µê°'"></span>
        <span class="like-count" th:text="${story.likes}">0</span>
        <span class="comment-button" onclick="openCommentPopup(event, this)">ğŸ’¬ ëŒ“ê¸€ì“°ê¸°</span>
      </div>
    </div>
  </div>

  <!-- ëŒ“ê¸€ íŒì—… -->
  <div class="modal-overlay" id="comment-modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h3>ëŒ“ê¸€</h3>
      <div id="comments-area">
        <p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
      <input type="text" id="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" />
      <button id="submit-comment">ë“±ë¡</button>
    </div>
  </div>

  <th:block th:replace="story/mainFooter :: mainFooter"></th:block>

  <script>
    function clearInPut(el) {
      if (el.value === "ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”.") el.value = "";
    }

    // ëŒ“ê¸€ íŒì—… ê´€ë ¨
    const commentModal = document.getElementById("comment-modal");
    const commentsArea = document.getElementById("comments-area");
    const closeButton = document.querySelector(".close-button");
    const commentInput = document.getElementById("comment-input");
    const submitButton = document.getElementById("submit-comment");

    let currentStoryId = null;

    function openCommentPopup(event, button) {
      event.stopPropagation(); // ì¹´ë“œ í´ë¦­ ë§‰ê¸°
      const storyCard = button.closest(".story-card");
      currentStoryId = storyCard.getAttribute("data-story-id");
      commentModal.classList.add("visible");
      loadComments(currentStoryId);
    }

    function closeModal() {
      commentModal.classList.remove("visible");
      commentsArea.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
      commentInput.value = "";
    }

    closeButton.addEventListener("click", closeModal);

    window.addEventListener("keydown", function (event) {
      if (event.key === "Escape" && commentModal.classList.contains("visible")) {
        closeModal();
      }
    });

    commentModal.addEventListener("click", function (event) {
      if (event.target === commentModal) {
        closeModal();
      }
    });
    submitButton.addEventListener("click", function () {
      const comment = commentInput.value.trim();
      if (!comment) return alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.");

      commentsArea.innerHTML += `
        <div class="comment">
          <strong>ë‚˜</strong><br>
          <p>${comment}</p>
        </div>
        <hr />
      `;
      commentInput.value = "";
    });

    // ê³µê° ì²˜ë¦¬
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".like-button").forEach((btn) => {
        btn.addEventListener("click", function (e) {
          e.stopPropagation();
          const card = this.closest(".story-card");
          const countSpan = card.querySelector(".like-count");
          let count = parseInt(countSpan.textContent) || 0;
          if (this.classList.contains("liked")) {
            this.classList.remove("liked");
            this.textContent = "ğŸ’— ê³µê°";
            count--;
          } else {
            this.classList.add("liked");
            this.textContent = "ğŸ’— ê³µê°ì·¨ì†Œ";
            count++;
          }
          countSpan.textContent = Math.max(0, count);
        });
      });
    });
  </script>
</body>
</html>
